<!-- Modal markup -->
<div class="modal-overlay" id="dateModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal" role="document">
    <div class="modal-header">
      <div>
        <div id="modalTitle" class="modal-title">Select Dates</div>
        <div style="color:#6b7280;font-size:13px;margin-top:4px">Choose your check-in and checkout dates</div>
      </div>
      <button class="modal-close" id="closeModal" aria-label="Close date picker">âœ•</button>
    </div>

    <div class="modal-content">
      <!-- checkin / checkout summary -->
      <div class="check-grid" id="checkSummary">
        <div>
          <div class="check-label">Check-In date</div>
          <div class="check-box" id="checkinBox">
            <div class="icon">ðŸ“…</div>
            <div>
              <div class="check-text" id="checkinText">â€”</div>
            </div>
          </div>
        </div>
        <div>
          <div class="check-label">Checkout date</div>
          <div class="check-box" id="checkoutBox">
            <div class="icon">ðŸ“…</div>
            <div>
              <div class="check-text" id="checkoutText">â€”</div>
            </div>
          </div>
        </div>
      </div>

      <!-- dual calendar -->
      <div class="calendar-widget">
        <div class="cal-container">
          <div class="cal-month">
            <div class="cal-top">
              <div class="cal-title" id="modalMonthTitleLeft">Month Year</div>
              <div class="cal-controls" role="toolbar">
                <button id="modalPrev" aria-label="Previous month">â—€</button>
                <button id="modalToday" aria-label="Current month">Today</button>
              </div>
            </div>
            <div class="weekday-row">
              <div class="weekday">Sun</div><div class="weekday">Mon</div><div class="weekday">Tue</div>
              <div class="weekday">Wed</div><div class="weekday">Thu</div><div class="weekday">Fri</div>
              <div class="weekday">Sat</div>
            </div>
            <div class="days-grid" id="modalDaysGridLeft" role="grid" aria-label="Calendar days"></div>
          </div>

          <div class="cal-month">
            <div class="cal-top">
              <div class="cal-title" id="modalMonthTitleRight">Month Year</div>
            </div>
            <div class="weekday-row" aria-hidden="true">
              <div class="weekday">Sun</div><div class="weekday">Mon</div><div class="weekday">Tue</div>
              <div class="weekday">Wed</div><div class="weekday">Thu</div><div class="weekday">Fri</div>
              <div class="weekday">Sat</div>
            </div>
            <div class="days-grid" id="modalDaysGridRight" role="grid" aria-label="Calendar days"></div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="cancelBtn" type="button">Cancel</button>
        <button class="btn" id="applyBtn" type="button">Apply dates</button>
      </div>
    </div>
  </div>
</div>

<!-- Updated script -->
<script>
(function () {
  /* Elements */
  const datesInput = document.getElementById('dates');
  const dateModal = document.getElementById('dateModal');
  const closeModal = document.getElementById('closeModal');
  const cancelBtn = document.getElementById('cancelBtn');
  const applyBtn = document.getElementById('applyBtn');

  const modalMonthTitleLeft = document.getElementById('modalMonthTitleLeft');
  const modalMonthTitleRight = document.getElementById('modalMonthTitleRight');
  const modalDaysGridLeft = document.getElementById('modalDaysGridLeft');
  const modalDaysGridRight = document.getElementById('modalDaysGridRight');
  const modalPrev = document.getElementById('modalPrev');
  const modalToday = document.getElementById('modalToday');

  const checkinText = document.getElementById('checkinText');
  const checkoutText = document.getElementById('checkoutText');
  const checkinHidden = document.getElementById('checkin');
  const checkoutHidden = document.getElementById('checkout');

  /* State */
  let viewDate = new Date(); viewDate.setDate(1);
  let startDate = null;
  let endDate = null;
  const todayBase = new Date(); todayBase.setHours(0,0,0,0);

  function pad(n){return n<10?'0'+n:''+n;}
  function isSameDay(a,b){ return a && b && a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }
  function formatFriendly(a,b){
    if(!a) return '';
    const months=["January","February","March","April","May","June","July","August","September","October","November","December"];
    if(!b || isSameDay(a,b)) return months[a.getMonth()]+' '+a.getDate()+', '+a.getFullYear();
    let s=a,e=b; if(s>e)[s,e]=[e,s];
    if(s.getFullYear()===e.getFullYear()){
      if(s.getMonth()===e.getMonth()) return months[s.getMonth()]+' '+s.getDate()+'â€“'+e.getDate()+', '+s.getFullYear();
      return months[s.getMonth()]+' '+s.getDate()+' â€“ '+months[e.getMonth()]+' '+e.getDate()+', '+s.getFullYear();
    }
    return months[s.getMonth()]+' '+s.getDate()+', '+s.getFullYear()+' â€“ '+months[e.getMonth()]+' '+e.getDate()+', '+e.getFullYear();
  }

  /* Open/Close modal */
  function openModal(){
    dateModal.classList.add('open');
    dateModal.setAttribute('aria-hidden','false');
    document.documentElement.style.overflow='hidden';
    closeModal.focus();
    renderModal();
  }
  function closeModalFn(commit=false){
    dateModal.classList.remove('open');
    dateModal.setAttribute('aria-hidden','true');
    document.documentElement.style.overflow='';
    if(commit && startDate){
      datesInput.value = formatFriendly(startDate, endDate || startDate);
      checkinHidden.value = startDate ? startDate.getFullYear()+'-'+pad(startDate.getMonth()+1)+'-'+pad(startDate.getDate()) : '';
      checkoutHidden.value = endDate ? endDate.getFullYear()+'-'+pad(endDate.getMonth()+1)+'-'+pad(endDate.getDate()) : '';
    }
    datesInput.focus();
  }

  /* Event listeners */
  datesInput.addEventListener('click', openModal);
  datesInput.addEventListener('focus', openModal);
  closeModal.addEventListener('click',()=>closeModalFn(false));
  cancelBtn.addEventListener('click',()=>closeModalFn(false));
  applyBtn.addEventListener('click',()=>closeModalFn(true));
  dateModal.addEventListener('click',(ev)=>{ if(ev.target===dateModal) closeModalFn(false); });
  document.addEventListener('keydown',(ev)=>{ if(ev.key==='Escape' && dateModal.classList.contains('open')) closeModalFn(false); });
  datesInput.addEventListener('dblclick',()=>{ startDate=endDate=null; datesInput.value=''; checkinHidden.value=''; checkoutHidden.value=''; updateSummaryTexts(); });

  /* Summary text */
  function updateSummaryTexts(){
    checkinText.textContent = startDate ? formatFriendly(startDate,null) : 'â€”';
    checkoutText.textContent = endDate ? formatFriendly(endDate,null) : 'â€”';
  }
  updateSummaryTexts();

  /* Render single month */
  function renderMonth(gridEl, year, month){
    gridEl.innerHTML='';
    const first = new Date(year,month,1);
    const startWeekday = first.getDay();
    const lastOfMonth = new Date(year,month+1,0).getDate();
    const prevMonthLast = new Date(year,month,0).getDate();
    const total=42;

    for(let i=0;i<total;i++){
      const btn=document.createElement('button');
      btn.className='day'; btn.type='button'; btn.setAttribute('role','gridcell');
      const dayIndex=i-startWeekday+1;
      let cellDate;
      if(dayIndex<=0) { cellDate=new Date(year,month-1,prevMonthLast+dayIndex); btn.classList.add('other-month'); }
      else if(dayIndex>lastOfMonth) { cellDate=new Date(year,month+1,dayIndex-lastOfMonth); btn.classList.add('other-month'); }
      else { cellDate=new Date(year,month,dayIndex); }

      const dn=document.createElement('div'); dn.className='date-num'; dn.textContent=cellDate.getDate(); btn.appendChild(dn);

      const cellNorm=new Date(cellDate.getFullYear(),cellDate.getMonth(),cellDate.getDate());
      if(cellNorm<todayBase) btn.disabled=true;
      if(isSameDay(cellDate,todayBase)) btn.classList.add('today');

      if(startDate && endDate){
        let s=startDate,e=endDate; if(s>e)[s,e]=[e,s];
        if(cellDate>=s && cellDate<=e){ btn.classList.add('range'); if(isSameDay(cellDate,s)) btn.classList.add('start'); if(isSameDay(cellDate,e)) btn.classList.add('end'); }
        if(isSameDay(cellDate,startDate)||isSameDay(cellDate,endDate)) btn.classList.add('selected');
      } else if(startDate && isSameDay(cellDate,startDate)) btn.classList.add('selected');

      btn.addEventListener('mouseenter',()=>{
        if(btn.disabled) return;
        if(startDate && !endDate){ checkinText.textContent=formatFriendly(startDate,null); checkoutText.textContent=formatFriendly(startDate,cellDate); }
        else if(!startDate){ checkinText.textContent=formatFriendly(cellDate,null); checkoutText.textContent='â€”'; }
        else { checkinText.textContent=formatFriendly(startDate,null); checkoutText.textContent=endDate?formatFriendly(endDate,null):'â€”'; }
      });
      btn.addEventListener('mouseleave',updateSummaryTexts);
      btn.addEventListener('click',()=>{
        if(btn.disabled) return;
        if(!startDate || (startDate && endDate)){ startDate=new Date(cellDate.getFullYear(),cellDate.getMonth(),cellDate.getDate()); endDate=null; }
        else if(!endDate) endDate=new Date(cellDate.getFullYear(),cellDate.getMonth(),cellDate.getDate());
        updateSummaryTexts(); renderModal();
      });
      btn.addEventListener('keydown',(ev)=>{ if(ev.key==='Enter'||ev.key===' '){ ev.preventDefault(); btn.click(); } });

      gridEl.appendChild(btn);
    }
  }

  /* Render dual months */
  function renderModal(){
    const leftMonth=viewDate.getMonth();
    const leftYear=viewDate.getFullYear();
    const rightDate=new Date(leftYear,leftMonth+1,1);
    const rightMonth=rightDate.getMonth();
    const rightYear=rightDate.getFullYear();

    modalMonthTitleLeft.textContent=viewDate.toLocaleString(undefined,{month:'long',year:'numeric'});
    modalMonthTitleRight.textContent=rightDate.toLocaleString(undefined,{month:'long',year:'numeric'});

    renderMonth(modalDaysGridLeft,leftYear,leftMonth);
    renderMonth(modalDaysGridRight,rightYear,rightMonth);
  }

  /* Controls */
  modalPrev.addEventListener('click',()=>{ viewDate.setMonth(viewDate.getMonth()-1); renderModal(); });
  modalToday.addEventListener('click',()=>{ viewDate=new Date(); viewDate.setDate(1); renderModal(); });
})();
</script>

<!-- CSS additions -->
<style>
.cal-container { display:flex; gap:12px; }
.cal-month { flex:1; }
@media (max-width:720px){ .cal-container{ flex-direction:column; } }
</style>
